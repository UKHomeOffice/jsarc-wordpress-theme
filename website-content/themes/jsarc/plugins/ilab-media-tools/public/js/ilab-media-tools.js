!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}(function(t){"use strict";var i=t(window),e=t(document),s=window.location,o=window.navigator,a=window.ArrayBuffer,h=window.Uint8Array,n=window.DataView,r=window.btoa,p="cropper-hidden",c="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",l=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,d=/^data\:/,g=/^data\:([^\;]+)\;base64,/,u=/^data\:image\/jpeg.*;base64,/,f=t.isFunction(t("<canvas>")[0].getContext),m=o&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(o.userAgent),v=Number,w=Math.min,x=Math.max,b=Math.abs,C=Math.sin,B=Math.cos,y=Math.sqrt,D=Math.round,$=Math.floor,L=String.fromCharCode;function M(t){return"number"==typeof t&&!isNaN(t)}function T(t){return void 0===t}function X(t,i){var e=[];return M(i)&&e.push(i),e.slice.apply(t,e)}function Y(t,i){var e=X(arguments,2);return function(){return t.apply(i,e.concat(X(arguments)))}}function k(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==s.protocol||i[2]!==s.hostname||i[3]!==s.port)}function W(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function z(t){return t?' crossOrigin="'+t+'"':""}function H(t){var i=[],e=t.rotate,s=t.scaleX,o=t.scaleY;return M(s)&&M(o)&&i.push("scale("+s+","+o+")"),M(e)&&i.push("rotate("+e+"deg)"),i.length?i.join(" "):"none"}function R(t,i){var e,s,o=b(t.degree)%180,a=(o>90?180-o:o)*Math.PI/180,h=C(a),n=B(a),r=t.width,p=t.height,c=t.aspectRatio;return i?s=(e=r/(n+h/c))/c:(e=r*n+p*h,s=r*h+p*n),{width:e,height:s}}function O(i,e){var s,o,a,h=t("<canvas>")[0],n=h.getContext("2d"),r=0,p=0,c=e.naturalWidth,l=e.naturalHeight,d=e.rotate,g=e.scaleX,u=e.scaleY,f=M(g)&&M(u)&&(1!==g||1!==u),m=M(d)&&0!==d,v=m||f,w=c*b(g||1),x=l*b(u||1);return f&&(s=w/2,o=x/2),m&&(s=(w=(a=R({width:w,height:x,degree:d})).width)/2,o=(x=a.height)/2),h.width=w,h.height=x,v&&(r=-c/2,p=-l/2,n.save(),n.translate(s,o)),f&&n.scale(g,u),m&&n.rotate(d*Math.PI/180),n.drawImage(i,$(r),$(p),$(c),$(l)),v&&n.restore(),h}function P(t){var i,e,s,o,a,h,r,p,c,l=new n(t),d=l.byteLength;if(255===l.getUint8(0)&&216===l.getUint8(1))for(p=2;p<d;){if(255===l.getUint8(p)&&225===l.getUint8(p+1)){h=p;break}p++}if(h&&(e=h+10,"Exif"===function(t,i,e){var s,o="";for(s=i,e+=i;s<e;s++)o+=L(t.getUint8(s));return o}(l,h+4,4)&&((o=18761===(a=l.getUint16(e)))||19789===a)&&42===l.getUint16(e+2,o)&&(s=l.getUint32(e+4,o))>=8&&(r=e+s)),r)for(d=l.getUint16(r,o),c=0;c<d;c++)if(p=r+12*c+2,274===l.getUint16(p,o)){p+=8,i=l.getUint16(p,o),m&&l.setUint16(p,1,o);break}return i}function E(i,e){this.$element=t(i),this.options=t.extend({},E.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}E.prototype={constructor:E,init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&f&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var s=t.Event(i,e);return this.$element.trigger(s),s},load:function(i){var e,s,o=this.options,n=this.$element;if(i&&(n.one("build.cropper",o.build),!this.trigger("build.cropper").isDefaultPrevented())){if(this.url=i,this.image={},!o.checkOrientation||!a)return this.clone();if(e=t.proxy(this.read,this),d.test(i))return u.test(i)?e(function(t){var i,e=t.replace(g,""),s=atob(e),o=s.length,n=new a(o),r=new h(n);for(i=0;i<o;i++)r[i]=s.charCodeAt(i);return n}(i)):this.clone();(s=new XMLHttpRequest).onerror=s.onabort=t.proxy(function(){this.clone()},this),s.onload=function(){e(this.response)},o.checkCrossOrigin&&k(i)&&n.prop("crossOrigin")&&(i=W(i)),s.open("get",i),s.responseType="arraybuffer",s.send()}},read:function(t){var i,e,s,o=this.options,a=P(t),n=this.image;if(a>1)switch(this.url=function(t){var i,e=new h(t),s=e.length,o="";for(i=0;i<s;i++)o+=L(e[i]);return"data:image/jpeg;base64,"+r(o)}(t),a){case 2:e=-1;break;case 3:i=-180;break;case 4:s=-1;break;case 5:i=90,s=-1;break;case 6:i=90;break;case 7:i=90,e=-1;break;case 8:i=-90}o.rotatable&&(n.rotate=i),o.scalable&&(n.scaleX=e,n.scaleY=s),this.clone()},clone:function(){var i,e,s=this.options,o=this.$element,a=this.url,h="";s.checkCrossOrigin&&k(a)&&((h=o.prop("crossOrigin"))?i=a:(h="anonymous",i=W(a))),this.crossOrigin=h,this.crossOriginUrl=i,this.$clone=e=t("<img"+z(h)+' src="'+(i||a)+'">'),this.isImg?o[0].complete?this.start():o.one("load.cropper",t.proxy(this.start,this)):e.one("load.cropper",t.proxy(this.start,this)).one("error.cropper",t.proxy(this.stop,this)).addClass("cropper-hide").insertAfter(o)},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off("error.cropper",this.stop),i=e),function(t,i){var e;if(t.naturalWidth&&!m)return i(t.naturalWidth,t.naturalHeight);(e=document.createElement("img")).onload=function(){i(this.width,this.height)},e.src=t.src}(i[0],t.proxy(function(i,e){t.extend(this.image,{naturalWidth:i,naturalHeight:e,aspectRatio:i/e}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var i,e,s,o=this.options,a=this.$element,h=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=a.parent(),this.$cropper=i=t(E.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(h),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=s=e.find(".cropper-face"),a.addClass(p).after(i),this.isImg||h.removeClass("cropper-hide"),this.initPreview(),this.bind(),o.aspectRatio=x(0,o.aspectRatio)||NaN,o.viewMode=x(0,w(3,D(o.viewMode)))||0,o.autoCrop?(this.isCropped=!0,o.modal&&this.$dragBox.addClass("cropper-modal")):e.addClass(p),o.guides||e.find(".cropper-dashed").addClass(p),o.center||e.find(".cropper-center").addClass(p),o.cropBoxMovable&&s.addClass("cropper-move").data("action","all"),o.highlight||s.addClass("cropper-invisible"),o.background&&i.addClass("cropper-bg"),o.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(p),this.setDragMode(o.dragMode),this.render(),this.isBuilt=!0,this.setData(o.data),a.one("built.cropper",o.built),setTimeout(t.proxy(function(){this.trigger("built.cropper"),this.trigger("crop.cropper",this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass(p),i.removeClass(p),s.css(this.container={width:x(e.width(),v(t.minContainerWidth)||200),height:x(e.height(),v(t.minContainerHeight)||100)}),i.addClass(p),s.removeClass(p)},initCanvas:function(){var i,e=this.options.viewMode,s=this.container,o=s.width,a=s.height,h=this.image,n=h.naturalWidth,r=h.naturalHeight,p=90===b(h.rotate),c=p?r:n,l=p?n:r,d=c/l,g=o,u=a;a*d>o?3===e?g=a*d:u=o/d:3===e?u=o/d:g=a*d,(i={naturalWidth:c,naturalHeight:l,aspectRatio:d,width:g,height:u}).oldLeft=i.left=(o-g)/2,i.oldTop=i.top=(a-u)/2,this.canvas=i,this.isLimited=1===e||2===e,this.limitCanvas(!0,!0),this.initialImage=t.extend({},h),this.initialCanvas=t.extend({},i)},limitCanvas:function(t,i){var e,s,o,a,h=this.options,n=h.viewMode,r=this.container,p=r.width,c=r.height,l=this.canvas,d=l.aspectRatio,g=this.cropBox,u=this.isCropped&&g;t&&(e=v(h.minCanvasWidth)||0,s=v(h.minCanvasHeight)||0,n&&(n>1?(e=x(e,p),s=x(s,c),3===n&&(s*d>e?e=s*d:s=e/d)):e?e=x(e,u?g.width:0):s?s=x(s,u?g.height:0):u&&(e=g.width,(s=g.height)*d>e?e=s*d:s=e/d)),e&&s?s*d>e?s=e/d:e=s*d:e?s=e/d:s&&(e=s*d),l.minWidth=e,l.minHeight=s,l.maxWidth=1/0,l.maxHeight=1/0),i&&(n?(o=p-l.width,a=c-l.height,l.minLeft=w(0,o),l.minTop=w(0,a),l.maxLeft=x(0,o),l.maxTop=x(0,a),u&&this.isLimited&&(l.minLeft=w(g.left,g.left+g.width-l.width),l.minTop=w(g.top,g.top+g.height-l.height),l.maxLeft=g.left,l.maxTop=g.top,2===n&&(l.width>=p&&(l.minLeft=w(0,o),l.maxLeft=x(0,o)),l.height>=c&&(l.minTop=w(0,a),l.maxTop=x(0,a))))):(l.minLeft=-l.width,l.minTop=-l.height,l.maxLeft=p,l.maxTop=c))},renderCanvas:function(t){var i,e,s=this.canvas,o=this.image,a=o.rotate,h=o.naturalWidth,n=o.naturalHeight;this.isRotated&&(this.isRotated=!1,(i=(e=R({width:o.width,height:o.height,degree:a})).width/e.height)!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=h,s.naturalHeight=n,a%180&&(e=R({width:h,height:n,degree:a}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=w(x(s.width,s.minWidth),s.maxWidth),s.height=w(x(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=w(x(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=w(x(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,s=this.canvas,o=this.image;o.rotate&&(e=R({width:s.width,height:s.height,degree:o.rotate,aspectRatio:o.aspectRatio},!0)),t.extend(o,e?{width:e.width,height:e.height,left:(s.width-e.width)/2,top:(s.height-e.height)/2}:{width:s.width,height:s.height,left:0,top:0}),this.$clone.css({width:o.width,height:o.height,marginLeft:o.left,marginTop:o.top,transform:H(o)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,s=i.aspectRatio,o=v(i.autoCropArea)||.8,a={width:e.width,height:e.height};s&&(e.height*s>e.width?a.height=a.width/s:a.width=a.height*s),this.cropBox=a,this.limitCropBox(!0,!0),a.width=w(x(a.width,a.minWidth),a.maxWidth),a.height=w(x(a.height,a.minHeight),a.maxHeight),a.width=x(a.minWidth,a.width*o),a.height=x(a.minHeight,a.height*o),a.oldLeft=a.left=e.left+(e.width-a.width)/2,a.oldTop=a.top=e.top+(e.height-a.height)/2,this.initialCropBox=t.extend({},a)},limitCropBox:function(t,i){var e,s,o,a,h=this.options,n=h.aspectRatio,r=this.container,p=r.width,c=r.height,l=this.canvas,d=this.cropBox,g=this.isLimited;t&&(e=v(h.minCropBoxWidth)||0,s=v(h.minCropBoxHeight)||0,e=w(e,p),s=w(s,c),o=w(p,g?l.width:p),a=w(c,g?l.height:c),n&&(e&&s?s*n>e?s=e/n:e=s*n:e?s=e/n:s&&(e=s*n),a*n>o?a=o/n:o=a*n),d.minWidth=w(e,o),d.minHeight=w(s,a),d.maxWidth=o,d.maxHeight=a),i&&(g?(d.minLeft=x(0,l.left),d.minTop=x(0,l.top),d.maxLeft=w(p,l.left+l.width)-d.width,d.maxTop=w(c,l.top+l.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=p-d.width,d.maxTop=c-d.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,o=this.cropBox;(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=w(x(o.width,o.minWidth),o.maxWidth),o.height=w(x(o.height,o.minHeight),o.maxHeight),this.limitCropBox(!1,!0),o.oldLeft=o.left=w(x(o.left,o.minLeft),o.maxLeft),o.oldTop=o.top=w(x(o.top,o.minTop),o.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data("action",o.width===e&&o.height===s?"move":"all"),this.$cropBox.css({width:o.width,height:o.height,left:o.left,top:o.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger("crop.cropper",this.getData())},initPreview:function(){var i,e=z(this.crossOrigin),s=e?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$clone2=i=t("<img"+e+' src="'+s+'">'),this.$viewBox.html(i),this.$preview.each(function(){var i=t(this);i.data("preview",{width:i.width(),height:i.height(),html:i.html()}),i.html("<img"+e+' src="'+s+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data("preview");i.css({width:e.width,height:e.height}).html(e.html).removeData("preview")})},preview:function(){var i=this.image,e=this.canvas,s=this.cropBox,o=s.width,a=s.height,h=i.width,n=i.height,r=s.left-e.left-i.left,p=s.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:h,height:n,marginLeft:-r,marginTop:-p,transform:H(i)}),this.$preview.each(function(){var e=t(this),s=e.data("preview"),c=s.width,l=s.height,d=c,g=l,u=1;o&&(g=a*(u=c/o)),a&&g>l&&(d=o*(u=l/a),g=l),e.css({width:d,height:g}).find("img").css({width:h*u,height:n*u,marginLeft:-r*u,marginTop:-p*u,transform:H(i)})}))},bind:function(){var s=this.options,o=this.$element,a=this.$cropper;t.isFunction(s.cropstart)&&o.on("cropstart.cropper",s.cropstart),t.isFunction(s.cropmove)&&o.on("cropmove.cropper",s.cropmove),t.isFunction(s.cropend)&&o.on("cropend.cropper",s.cropend),t.isFunction(s.crop)&&o.on("crop.cropper",s.crop),t.isFunction(s.zoom)&&o.on("zoom.cropper",s.zoom),a.on("mousedown touchstart pointerdown MSPointerDown",t.proxy(this.cropStart,this)),s.zoomable&&s.zoomOnWheel&&a.on("wheel mousewheel DOMMouseScroll",t.proxy(this.wheel,this)),s.toggleDragModeOnDblclick&&a.on("dblclick",t.proxy(this.dblclick,this)),e.on("mousemove touchmove pointermove MSPointerMove",this._cropMove=Y(this.cropMove,this)).on(c,this._cropEnd=Y(this.cropEnd,this)),s.responsive&&i.on("resize.cropper",this._resize=Y(this.resize,this))},unbind:function(){var s=this.options,o=this.$element,a=this.$cropper;t.isFunction(s.cropstart)&&o.off("cropstart.cropper",s.cropstart),t.isFunction(s.cropmove)&&o.off("cropmove.cropper",s.cropmove),t.isFunction(s.cropend)&&o.off("cropend.cropper",s.cropend),t.isFunction(s.crop)&&o.off("crop.cropper",s.crop),t.isFunction(s.zoom)&&o.off("zoom.cropper",s.zoom),a.off("mousedown touchstart pointerdown MSPointerDown",this.cropStart),s.zoomable&&s.zoomOnWheel&&a.off("wheel mousewheel DOMMouseScroll",this.wheel),s.toggleDragModeOnDblclick&&a.off("dblclick",this.dblclick),e.off("mousemove touchmove pointermove MSPointerMove",this._cropMove).off(c,this._cropEnd),s.responsive&&i.off("resize.cropper",this._resize)},resize:function(){var i,e,s,o=this.options.restore,a=this.$container,h=this.container;!this.isDisabled&&h&&(1===(s=a.width()/h.width)&&a.height()===h.height||(o&&(i=this.getCanvasData(),e=this.getCropBoxData()),this.render(),o&&(this.setCanvasData(t.each(i,function(t,e){i[t]=e*s})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*s})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass("cropper-crop")?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(i){var e=i.originalEvent||i,s=v(this.options.wheelZoomRatio)||.1,o=1;this.isDisabled||(i.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(t.proxy(function(){this.wheeling=!1},this),50),e.deltaY?o=e.deltaY>0?1:-1:e.wheelDelta?o=-e.wheelDelta/120:e.detail&&(o=e.detail>0?1:-1),this.zoom(-o*s,i)))},cropStart:function(i){var e,s,o=this.options,a=i.originalEvent,h=a&&a.touches,n=i;if(!this.isDisabled){if(h){if((e=h.length)>1){if(!o.zoomable||!o.zoomOnTouch||2!==e)return;n=h[1],this.startX2=n.pageX,this.startY2=n.pageY,s="zoom"}n=h[0]}if(s=s||t(n.target).data("action"),l.test(s)){if(this.trigger("cropstart.cropper",{originalEvent:a,action:s}).isDefaultPrevented())return;i.preventDefault(),this.action=s,this.cropping=!1,this.startX=n.pageX||a&&a.pageX,this.startY=n.pageY||a&&a.pageY,"crop"===s&&(this.cropping=!0,this.$dragBox.addClass("cropper-modal"))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,o=s&&s.touches,a=t,h=this.action;if(!this.isDisabled){if(o){if((i=o.length)>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;a=o[1],this.endX2=a.pageX,this.endY2=a.pageY}a=o[0]}if(h){if(this.trigger("cropmove.cropper",{originalEvent:s,action:h}).isDefaultPrevented())return;t.preventDefault(),this.endX=a.pageX||s&&s.pageX,this.endY=a.pageY||s&&s.pageY,this.change(a.shiftKey,"zoom"===h?t:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass("cropper-modal",this.isCropped&&this.options.modal)),this.action="",this.trigger("cropend.cropper",{originalEvent:i,action:e}))},change:function(t,i){var e,s,o,a,h,n,r,c=this.options.aspectRatio,l=this.action,d=this.container,g=this.canvas,u=this.cropBox,f=u.width,m=u.height,v=u.left,x=u.top,C=v+f,B=x+m,D=0,$=0,L=d.width,M=d.height,T=!0;switch(!c&&t&&(c=f&&m?f/m:1),this.isLimited&&(D=u.minLeft,$=u.minTop,L=D+w(d.width,g.left+g.width),M=$+w(d.height,g.top+g.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},c&&(s.X=s.y*c,s.Y=s.x/c),l){case"all":v+=s.x,x+=s.y;break;case"e":if(s.x>=0&&(C>=L||c&&(x<=$||B>=M))){T=!1;break}f+=s.x,c&&(m=f/c,x-=s.Y/2),f<0&&(l="w",f=0);break;case"n":if(s.y<=0&&(x<=$||c&&(v<=D||C>=L))){T=!1;break}m-=s.y,x+=s.y,c&&(f=m*c,v+=s.X/2),m<0&&(l="s",m=0);break;case"w":if(s.x<=0&&(v<=D||c&&(x<=$||B>=M))){T=!1;break}f-=s.x,v+=s.x,c&&(m=f/c,x+=s.Y/2),f<0&&(l="e",f=0);break;case"s":if(s.y>=0&&(B>=M||c&&(v<=D||C>=L))){T=!1;break}m+=s.y,c&&(f=m*c,v-=s.X/2),m<0&&(l="n",m=0);break;case"ne":if(c){if(s.y<=0&&(x<=$||C>=L)){T=!1;break}m-=s.y,x+=s.y,f=m*c}else s.x>=0?C<L?f+=s.x:s.y<=0&&x<=$&&(T=!1):f+=s.x,s.y<=0?x>$&&(m-=s.y,x+=s.y):(m-=s.y,x+=s.y);f<0&&m<0?(l="sw",m=0,f=0):f<0?(l="nw",f=0):m<0&&(l="se",m=0);break;case"nw":if(c){if(s.y<=0&&(x<=$||v<=D)){T=!1;break}m-=s.y,x+=s.y,f=m*c,v+=s.X}else s.x<=0?v>D?(f-=s.x,v+=s.x):s.y<=0&&x<=$&&(T=!1):(f-=s.x,v+=s.x),s.y<=0?x>$&&(m-=s.y,x+=s.y):(m-=s.y,x+=s.y);f<0&&m<0?(l="se",m=0,f=0):f<0?(l="ne",f=0):m<0&&(l="sw",m=0);break;case"sw":if(c){if(s.x<=0&&(v<=D||B>=M)){T=!1;break}f-=s.x,v+=s.x,m=f/c}else s.x<=0?v>D?(f-=s.x,v+=s.x):s.y>=0&&B>=M&&(T=!1):(f-=s.x,v+=s.x),s.y>=0?B<M&&(m+=s.y):m+=s.y;f<0&&m<0?(l="ne",m=0,f=0):f<0?(l="se",f=0):m<0&&(l="nw",m=0);break;case"se":if(c){if(s.x>=0&&(C>=L||B>=M)){T=!1;break}m=(f+=s.x)/c}else s.x>=0?C<L?f+=s.x:s.y>=0&&B>=M&&(T=!1):f+=s.x,s.y>=0?B<M&&(m+=s.y):m+=s.y;f<0&&m<0?(l="nw",m=0,f=0):f<0?(l="sw",f=0):m<0&&(l="ne",m=0);break;case"move":this.move(s.x,s.y),T=!1;break;case"zoom":this.zoom((o=b(this.startX-this.startX2),a=b(this.startY-this.startY2),h=b(this.endX-this.endX2),n=b(this.endY-this.endY2),r=y(o*o+a*a),(y(h*h+n*n)-r)/r),i),this.startX2=this.endX2,this.startY2=this.endY2,T=!1;break;case"crop":if(!s.x||!s.y){T=!1;break}e=this.$cropper.offset(),v=this.startX-e.left,x=this.startY-e.top,f=u.minWidth,m=u.minHeight,s.x>0?l=s.y>0?"se":"ne":s.x<0&&(v-=f,l=s.y>0?"sw":"nw"),s.y<0&&(x-=m),this.isCropped||(this.$cropBox.removeClass(p),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}T&&(u.width=f,u.height=m,u.left=v,u.top=x,this.action=l,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass("cropper-modal"),this.$cropBox.removeClass(p)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass("cropper-modal"),this.$cropBox.addClass(p))},replace:function(t,i){!this.isDisabled&&t&&(this.isImg&&this.$element.attr("src",t),i?(this.url=t,this.$clone.attr("src",t),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass("cropper-disabled"))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass("cropper-disabled"))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(p)):this.isImg?t.off("load.cropper",this.start):this.$clone&&this.$clone.remove(),t.removeData("cropper")},move:function(t,i){var e=this.canvas;this.moveTo(T(t)?t:e.left+v(t),T(i)?i:e.top+v(i))},moveTo:function(t,i){var e=this.canvas,s=!1;T(i)&&(i=t),t=v(t),i=v(i),this.isBuilt&&!this.isDisabled&&this.options.movable&&(M(t)&&(e.left=t,s=!0),M(i)&&(e.top=i,s=!0),s&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=(t=v(t))<0?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(i,e){var s,o,a,h,n,r,p,c,l,d=this.options,g=this.canvas,u=g.width,f=g.height,m=g.naturalWidth,w=g.naturalHeight;if((i=v(i))>=0&&this.isBuilt&&!this.isDisabled&&d.zoomable){if(o=m*i,a=w*i,e&&(s=e.originalEvent),this.trigger("zoom.cropper",{originalEvent:s,oldRatio:u/m,ratio:o/m}).isDefaultPrevented())return;s?(h=this.$cropper.offset(),n=s.touches?(r=s.touches,p=r.length,c=0,l=0,p&&(t.each(r,function(t,i){c+=i.pageX,l+=i.pageY}),c/=p,l/=p),{pageX:c,pageY:l}):{pageX:e.pageX||s.pageX||0,pageY:e.pageY||s.pageY||0},g.left-=(o-u)*((n.pageX-h.left-g.left)/u),g.top-=(a-f)*((n.pageY-h.top-g.top)/f)):(g.left-=(o-u)/2,g.top-=(a-f)/2),g.width=o,g.height=a,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+v(t))},rotateTo:function(t){M(t=v(t))&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,i){var e=this.image,s=!1;T(i)&&(i=t),t=v(t),i=v(i),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(M(t)&&(e.scaleX=t,s=!0),M(i)&&(e.scaleY=i,s=!0),s&&this.renderImage(!0))},scaleX:function(t){var i=this.image.scaleY;this.scale(t,M(i)?i:1)},scaleY:function(t){var i=this.image.scaleX;this.scale(M(i)?i:1,t)},getData:function(i){var e,s,o=this.options,a=this.image,h=this.canvas,n=this.cropBox;return this.isBuilt&&this.isCropped?(s={x:n.left-h.left,y:n.top-h.top,width:n.width,height:n.height},e=a.width/a.naturalWidth,t.each(s,function(t,o){o/=e,s[t]=i?D(o):o})):s={x:0,y:0,width:0,height:0},o.rotatable&&(s.rotate=a.rotate||0),o.scalable&&(s.scaleX=a.scaleX||1,s.scaleY=a.scaleY||1),s},setData:function(i){var e,s,o,a=this.options,h=this.image,n=this.canvas,r={};t.isFunction(i)&&(i=i.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(i)&&(a.rotatable&&M(i.rotate)&&i.rotate!==h.rotate&&(h.rotate=i.rotate,this.isRotated=e=!0),a.scalable&&(M(i.scaleX)&&i.scaleX!==h.scaleX&&(h.scaleX=i.scaleX,s=!0),M(i.scaleY)&&i.scaleY!==h.scaleY&&(h.scaleY=i.scaleY,s=!0)),e?this.renderCanvas():s&&this.renderImage(),o=h.width/h.naturalWidth,M(i.x)&&(r.left=i.x*o+n.left),M(i.y)&&(r.top=i.y*o+n.top),M(i.width)&&(r.width=i.width*o),M(i.height)&&(r.height=i.height*o),this.setCropBoxData(r))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,s){e[s]=i[s]}),e},setCanvasData:function(i){var e=this.canvas,s=e.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(i)&&(M(i.left)&&(e.left=i.left),M(i.top)&&(e.top=i.top),M(i.width)?(e.width=i.width,e.height=i.width/s):M(i.height)&&(e.height=i.height,e.width=i.height*s),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(i){var e,s,o=this.cropBox,a=this.options.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(i)&&(M(i.left)&&(o.left=i.left),M(i.top)&&(o.top=i.top),M(i.width)&&(e=!0,o.width=i.width),M(i.height)&&(s=!0,o.height=i.height),a&&(e?o.height=o.width/a:s&&(o.width=o.height*a)),this.renderCropBox())},getCroppedCanvas:function(i){var e,s,o,a,h,n,r,p,c,l,d;if(this.isBuilt&&f)return this.isCropped?(t.isPlainObject(i)||(i={}),d=this.getData(),e=d.width,s=d.height,p=e/s,t.isPlainObject(i)&&(h=i.width,n=i.height,h?(n=h/p,r=h/e):n&&(h=n*p,r=n/s)),o=$(h||e),a=$(n||s),(c=t("<canvas>")[0]).width=o,c.height=a,l=c.getContext("2d"),i.fillColor&&(l.fillStyle=i.fillColor,l.fillRect(0,0,o,a)),l.drawImage.apply(l,function(){var t,i,o,a,h,n,p=O(this.$clone[0],this.image),c=p.width,l=p.height,g=this.canvas,u=[p],f=d.x+g.naturalWidth*(b(d.scaleX||1)-1)/2,m=d.y+g.naturalHeight*(b(d.scaleY||1)-1)/2;return f<=-e||f>c?f=t=o=h=0:f<=0?(o=-f,t=h=w(c,e+(f=0))):f<=c&&(o=0,t=h=w(e,c-f)),t<=0||m<=-s||m>l?m=i=a=n=0:m<=0?(a=-m,i=n=w(l,s+(m=0))):m<=l&&(a=0,i=n=w(s,l-m)),u.push($(f),$(m),$(t),$(i)),r&&(o*=r,a*=r,h*=r,n*=r),h>0&&n>0&&u.push($(o),$(a),$(h),$(n)),u}.call(this)),c):O(this.$clone[0],this.image)},setAspectRatio:function(t){var i=this.options;this.isDisabled||T(t)||(i.aspectRatio=x(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i="crop"===t,e=s.movable&&"move"===t,t=i||e?t:"none",this.$dragBox.data("action",t).toggleClass("cropper-crop",i).toggleClass("cropper-move",e),s.cropBoxMovable||this.$face.data("action",t).toggleClass("cropper-crop",i).toggleClass("cropper-move",e))}},E.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},E.setDefaults=function(i){t.extend(E.DEFAULTS,i)},E.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',E.other=t.fn.cropper,t.fn.cropper=function(i){var e,s=X(arguments,1);return this.each(function(){var o,a,h=t(this),n=h.data("cropper");if(!n){if(/destroy/.test(i))return;o=t.extend({},h.data(),t.isPlainObject(i)&&i),h.data("cropper",n=new E(this,o))}"string"==typeof i&&t.isFunction(a=n[i])&&(e=a.apply(n,s))}),T(e)?this:e},t.fn.cropper.Constructor=E,t.fn.cropper.setDefaults=E.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=E.other,this}});
var ILabCrop=function(i,t){this.settings=t,this.modalContainer=i("#ilabm-container-"+t.modal_id),this.cropper=this.modalContainer.find(".ilabc-cropper"),this.cropperData={},this.modal_id=t.modal_id;var e,r=this,a=!1;this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:this.settings.size,tabSelected:function(i){ILabModal.loadURL(i.data("url"),!0,function(i){r.bindUI(i)})}}),i(window).resize(function(){a||(data=r.cropper.cropper("getData"),r.settings.prev_crop_x=data.x,r.settings.prev_crop_y=data.y,r.settings.prev_crop_width=data.width,r.settings.prev_crop_height=data.height),a=!0,r.updatePreviewWidth(),clearTimeout(e),e=setTimeout(r._resized,250)}),this.modalContainer.find(".ilabc-button-crop").on("click",function(i){return i.preventDefault(),r.crop(),!1}),this._resized=function(){r.bindUI(r.settings),a=!1},this.updatePreviewWidth=function(){var i=this.modalContainer.find(".ilab-crop-preview-title").width();this.modalContainer.find(".ilab-crop-preview").css({height:i/r.settings.aspect_ratio+"px",width:i+"px"})},this.bindUI=function(i){this.settings=i,this.cropper.cropper("destroy"),this.cropper.off("built.cropper"),i.hasOwnProperty("cropped_src")&&null!==i.cropped_src&&this.modalContainer.find(".ilab-current-crop-img").attr("src",i.cropped_src),i.hasOwnProperty("size_title")&&null!==i.size_title&&this.modalContainer.find(".ilabc-crop-size-title").text("Current "+i.size_title+" ("+i.min_width+" x "+i.min_height+")"),void 0!==i.aspect_ratio&&(this.updatePreviewWidth(),void 0!==i.prev_crop_x&&null!==i.prev_crop_x&&(this.cropperData={x:i.prev_crop_x,y:i.prev_crop_y,width:i.prev_crop_width,height:i.prev_crop_height}),this.cropper.on("built.cropper",function(){r.updatePreviewWidth()}).on("crop.cropper",function(i){}).cropper({viewMode:1,aspectRatio:i.aspect_ratio,minWidth:i.min_width,minHeight:i.min_height,modal:!0,zoomable:!1,mouseWheelZoom:!1,dragCrop:!1,autoCropArea:1,movable:!1,data:this.cropperData,checkImageOrigin:!1,checkCrossOrigin:!1,responsive:!0,preview:"#ilabm-container-"+this.modal_id+" .ilab-crop-preview"}))},this.crop=function(){var i=this;this.displayStatus("Saving crop ...");var t=this.cropper.cropper("getData");t.action="ilab_perform_crop",t.post=this.settings.image_id,t.size=this.settings.size,jQuery.post(ajaxurl,t,function(t){"ok"==t.status?(i.modalContainer.find(".ilab-current-crop-img").one("load",function(){i.hideStatus()}),i.modalContainer.find(".ilab-current-crop-img").attr("src",t.src)):i.hideStatus()})},this.displayStatus=function(i){r.modalContainer.find(".ilabm-status-label").text(i),r.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){r.modalContainer.find(".ilabm-status-container").addClass("is-hidden")},this.bindUI(t)};
var ImgixComponents={utilities:{byteToHex:function(t){var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];return e[t>>4&15]+e[15&t]}}};
!function(e){e.fn.imgixLabel=function(n){var t=e.extend({},n);return this.each(function(){var n,a=e(this),r=0,d=e('<input type="text" class="imgix-label-editor is-hidden" pattern="[0-9-]+">');a.parent().append(d),d.on("keydown",function(e){if(27==e.keyCode)d.off("blur"),d.off("input"),d.addClass("is-hidden"),t.hasOwnProperty("changed")&&t.changed(r),a.text(r);else if(13==e.keyCode){d.off("blur"),d.off("input");var n=parseInt(d.val());d.addClass("is-hidden"),t.hasOwnProperty("changed")&&t.changed(n),a.text(n)}else if(38==e.keyCode){n=parseInt(d.val());n++,d.val(n),t.hasOwnProperty("changed")&&t.changed(n),a.text(n)}else{if(40!=e.keyCode)return e.keyCode<57||(e.keyCode>90&&e.keyCode<105||(109==e.keyCode||(!!e.metaKey||(e.preventDefault(),!1))));n=parseInt(d.val());n--,d.val(n),t.hasOwnProperty("changed")&&t.changed(n),a.text(n)}}),a.on("click",function(e){return e.preventDefault(),d.on("input",function(){var e=parseInt(d.val());t.hasOwnProperty("changed")&&(clearTimeout(n),n=setTimeout(function(){t.changed(e)},500)),a.text(e)}),d.on("blur",function(){var e=parseInt(d.val());d.addClass("is-hidden"),t.hasOwnProperty("changed")&&t.changed(e),a.text(e)}),r=t.hasOwnProperty("currentValue")?t.currentValue():0,d.val(r),d.removeClass("is-hidden"),d.select(),d.focus(),!1})})}}(jQuery);
!function(e){ImgixComponents.ImgixSlider=function(i,t){this.delegate=i,this.container=t,this.valueLabel=t.find(".imgix-param-title-right > h3"),this.slider=t.find(".imgix-param"),this.resetButton=t.find(".imgix-param-reset"),this.defaultValue=t.data("default-value"),this.param=t.data("param");var a=this;this.container.find(".imgix-param-label").imgixLabel({currentValue:function(){return a.slider.val()},changed:function(i){i!=a.slider.val()&&(a.slider.val(i),e(document).trigger(a.param+"-changed",[i]),a.slider.hide().show(0),a.delegate.preview())}}),this.resetButton.on("click",function(){a.reset()}),this.slider.on("input",function(){a.valueLabel.text(a.slider.val())}),this.slider.on("change",function(){a.valueLabel.text(a.slider.val()),a.delegate.preview(),e(document).trigger(a.param+"-changed",[a.slider.val()])}),e(document).on("change-"+a.param,function(e,i){a.slider.val(i),a.valueLabel.text(i)})},ImgixComponents.ImgixSlider.prototype.destroy=function(){this.slider.off("input"),this.slider.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixSlider.prototype.reset=function(e){var i;i=e&&e.hasOwnProperty(this.param)?e[this.param]:this.defaultValue,this.valueLabel.text(i),this.slider.val(i),this.slider.hide().show(0),this.delegate.preview()},ImgixComponents.ImgixSlider.prototype.saveValue=function(e){return this.slider.val()!=this.defaultValue&&(e[this.param]=this.slider.val()),e}}(jQuery);
jQuery,ImgixComponents.ImgixColor=function(e,t){this.delegate=e,this.container=t,this.colorPicker=t.find(".imgix-param-color"),this.alphaSlider=t.find(".imgix-param-alpha"),this.type=t.data("param-type"),this.resetButton=t.find(".imgix-param-reset"),this.param=t.data("param"),this.defaultValue=t.data("default-value");var i=this;if("blend-color"==this.type){this.blendParam=t.data("blend-param"),this.blendSelect=t.find(".imgix-param-blend");var a=t.data("blend-value");this.blendSelect.val(a),this.blendSelect.on("change",function(){i.delegate.preview()})}this.colorPicker.wpColorPicker({palettes:!1,change:function(e,t){i.delegate.preview()}}),this.alphaSlider.on("change",function(){i.delegate.preview()}),this.resetButton.on("click",function(){i.reset()})},ImgixComponents.ImgixColor.prototype.destroy=function(){this.alphaSlider.off("change"),"blend-color"==this.type&&this.blendSelect.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixColor.prototype.reset=function(e){var t,i="none";if(void 0!==e&&e.hasOwnProperty(this.blendParam)&&(i=e[this.blendParam]),8==(t=(t=void 0!==e&&e.hasOwnProperty(this.param)?e[this.param]:this.defaultValue).replace("#","")).length){var a=parseInt("0x"+t.substring(0,2))/255*100;t=t.substring(2),this.alphaSlider.val(Math.round(a)),this.alphaSlider.hide().show(0)}else this.alphaSlider.val(0),this.alphaSlider.hide().show(0);this.colorPicker.val("#"+t),this.colorPicker.wpColorPicker("color","#"+t),"blend-color"==this.type&&this.blendSelect.val(i),this.delegate.preview()},ImgixComponents.ImgixColor.prototype.saveValue=function(e){return this.alphaSlider.val()>0&&(e[this.param]="#"+ImgixComponents.utilities.byteToHex(Math.round(parseFloat(this.alphaSlider.val())/100*255))+this.colorPicker.val().replace("#",""),"blend-color"==this.type&&"none"!=this.blendSelect.val()&&(e[this.blendParam]=this.blendSelect.val())),e};
!function(t){ImgixComponents.ImgixAlignment=function(e,a){this.delegate=e,this.container=a,this.alignmentParam=a.find(".imgix-param"),this.resetButton=a.find(".imgix-param-reset"),this.defaultValue=a.data("default-value"),this.param=a.data("param");var i=this;this.resetButton.on("click",function(){i.reset()}),a.find(".imgix-alignment-button").on("click",function(){var e=t(this);i.container.find(".imgix-alignment-button").each(function(){t(this).removeClass("selected-alignment")}),e.addClass("selected-alignment"),i.alignmentParam.val(e.data("param-value")),i.delegate.preview()})},ImgixComponents.ImgixAlignment.prototype.destroy=function(){this.resetButton.off("click"),this.container.find(".imgix-alignment-button").off("click")},ImgixComponents.ImgixAlignment.prototype.reset=function(e){var a;""==(a=e&&e.hasOwnProperty(this.param)?e[this.param]:this.defaultValue)&&(a=this.defaultValue),this.container.find(".imgix-alignment-button").each(function(){var e=t(this);e.data("param-value")==a?e.addClass("selected-alignment"):e.removeClass("selected-alignment")}),this.alignmentParam.val(a),this.delegate.preview()},ImgixComponents.ImgixAlignment.prototype.saveValue=function(t){return this.alignmentParam.val()!=this.defaultValue&&(t[this.param]=this.alignmentParam.val()),t}}(jQuery);
jQuery,ImgixComponents.ImgixMediaChooser=function(t,e){this.delegate=t,this.container=e,this.preview=e.find(".imgix-media-preview img"),this.mediaInput=e.find(".imgix-param"),this.selectButton=e.find(".imgix-media-button"),this.resetButton=e.find(".imgix-param-reset"),this.defaultValue=e.data("default-value"),this.param=e.data("param"),this.uploader=wp.media({title:"Select Watermark",button:{text:"Select Watermark"},multiple:!1});var i=this;this.resetButton.on("click",function(){i.reset()}),this.uploader.on("select",function(){attachment=i.uploader.state().get("selection").first().toJSON(),i.mediaInput.val(attachment.id),i.preview.attr("src",attachment.url),i.delegate.preview()}),this.selectButton.on("click",function(t){return t.preventDefault(),i.uploader.open(),!1})},ImgixComponents.ImgixMediaChooser.prototype.destroy=function(){this.selectButton.off("click"),this.uploader.off("select"),this.resetButton.off("click")},ImgixComponents.ImgixMediaChooser.prototype.reset=function(t){var e;t&&t.hasOwnProperty(this.param)?(e=t[this.param],this.mediaInput.val(e)):this.mediaInput.val(""),t&&t.hasOwnProperty(this.param+"_url")?this.preview.attr("src",t[this.param+"_url"]):(this.preview.removeAttr("src").replaceWith(this.preview.clone()),this.preview=this.container.find(".imgix-media-preview img")),this.delegate.preview()},ImgixComponents.ImgixMediaChooser.prototype.saveValue=function(t){var e=this.mediaInput.val();return e&&""!=e&&(t[this.param]=e),t};
!function(t){ImgixComponents.ImgixPillbox=function(e,i){this.delegate=e,this.container=i,this.param=i.data("param"),this.values=i.data("param-values").split(","),this.buttons=i.find(".ilabm-pill"),this.inputs={};var n=this;this.buttons.each(function(){var e=t(this),i=e.data("param");n.inputs[i]=n.container.find("input[name='"+i+"']"),e.on("click",function(s){return s.preventDefault(),0==n.inputs[i].val()?(n.inputs[i].val(1),e.addClass("pill-selected"),t(document).trigger(i+"-selected")):(n.inputs[i].val(0),e.removeClass("pill-selected"),t(document).trigger(i+"-deselected")),n.delegate.preview(),!1}),t(document).on("change-"+i,function(t,s){n.inputs[i].val(s?1:0),s?e.addClass("pill-selected"):e.removeClass("pill-selected")})})},ImgixComponents.ImgixPillbox.prototype.destroy=function(){this.buttons.off("click")},ImgixComponents.ImgixPillbox.prototype.reset=function(e){this.buttons.each(function(){t(this).removeClass("pill-selected")});var i=this;(Object.keys(this.inputs).forEach(function(t,e){i.inputs[t].val(0)}),e&&e.hasOwnProperty(this.param))&&e[this.param].split(",").forEach(function(t,e){i.inputs[t].val(1),i.container.find("imgix-pill-"+t).addClass("pill-selected")});this.delegate.preview()},ImgixComponents.ImgixPillbox.prototype.saveValue=function(t){var e=[],i=this;return Object.keys(this.inputs).forEach(function(t,n){1==i.inputs[t].val()&&e.push(t)}),e.length>0&&(t[this.param]=e.join(",")),t}}(jQuery);
var ILabImgixPresets=function(e,t,s){this.delegate=t,this.container=s.find(".ilabm-bottom-bar"),this.presetSelect=this.container.find(".imgix-presets"),this.presetContainer=this.container.find(".imgix-preset-container"),this.presetDefaultCheckbox=this.container.find(".imgix-preset-make-default");var i=this;i.presetSelect.on("change",function(){if(0==i.presetSelect.val)return i.delegate.resetAll(),void i.presetDefaultCheckbox.prop("checked",!1);var e=i.delegate.settings.presets[i.presetSelect.val()];e.default_for==i.delegate.settings.size&&i.presetDefaultCheckbox.prop("checked",!0),i.delegate.bindPreset(e)}),this.container.find(".imgix-new-preset-button").on("click",function(){i.newPreset()}),this.container.find(".imgix-save-preset-button").on("click",function(){i.savePreset()}),this.container.find(".imgix-delete-preset-button").on("click",function(){i.deletePreset()}),this.init=function(){i.presetSelect.find("option").remove(),0==Object.keys(i.delegate.settings.presets).length?i.presetContainer.addClass("is-hidden"):(Object.keys(i.delegate.settings.presets).forEach(function(t,s){i.presetSelect.append(e("<option></option>").attr("value","0").text("None")),i.presetSelect.append(e("<option></option>").attr("value",t).text(i.delegate.settings.presets[t].title))}),i.presetContainer.removeClass("is-hidden"),i.presetSelect.val(i.delegate.settings.currentPreset))},this.clearSelected=function(){i.presetSelect.val(0),i.presetDefaultCheckbox.prop("checked",!1)},this.setCurrentPreset=function(e,t){t?i.presetDefaultCheckbox.prop("checked",!0):i.presetDefaultCheckbox.prop("checked",!1),i.presetSelect.val(e)},this.newPreset=function(){var e=prompt("New preset name");if(null!=e){i.delegate.displayStatus("Saving preset ...");var t={};t.name=e,i.presetDefaultCheckbox.is(":checked")&&(t.make_default=1),i.delegate.postAjax("ilab_imgix_new_preset",t,function(e){i.delegate.hideStatus(),"ok"==e.status&&(i.delegate.settings.currentPreset=e.currentPreset,i.delegate.settings.presets=e.presets,i.init())})}},this.savePreset=function(){if(null!=i.presetSelect.val()){i.delegate.displayStatus("Saving preset ...");var e={};e.key=i.presetSelect.val(),i.presetDefaultCheckbox.is(":checked")&&(e.make_default=1),i.delegate.postAjax("ilab_imgix_save_preset",e,function(e){i.delegate.hideStatus()})}},this.deletePreset=function(){if(null!=i.presetSelect.val()&&confirm("Are you sure you want to delete this preset?")){i.delegate.displayStatus("Delete preset ...");var e={};e.key=i.presetSelect.val(),i.delegate.postAjax("ilab_imgix_delete_preset",e,function(e){i.delegate.hideStatus(),"ok"==e.status&&(i.delegate.settings.currentPreset=e.currentPreset,i.delegate.settings.presets=e.presets,i.init(),i.delegate.bindUI(e))})}},this.init()};
!function(a){a.fn.ilabSidebarTabs=function(i){var e=a.extend({},i),t=!1;return this.find(".ilabm-sidebar-tab").each(function(){var i=a(this),n=e.container.find("."+i.data("target"));t||(i.addClass("active-tab"),n.removeClass("is-hidden"),t=!0),i.on("click",function(t){return t.preventDefault(),e.container.find(".ilabm-sidebar-tab").each(function(){var i=a(this),t=e.container.find("."+i.data("target"));i.removeClass("active-tab"),t.addClass("is-hidden")}),i.addClass("active-tab"),n.removeClass("is-hidden"),!1})})}}(jQuery);
var ILabFaceEditor=function(e,t){var n=[],i=null,o=0;if(t.settings.meta.hasOwnProperty("faces")){for(var s=Number.MAX_VALUE,a=Number.MAX_VALUE,d=0,h=0,l=0;t.settings.meta.faces.hasOwnProperty(l);){var c=t.settings.meta.faces[l];s=Math.min(s,c.BoundingBox.Left),a=Math.min(a,c.BoundingBox.Top),d=Math.max(d,c.BoundingBox.Left+c.BoundingBox.Width),h=Math.max(h,c.BoundingBox.Top+c.BoundingBox.Height);var g={index:l+1,left:c.BoundingBox.Left,top:c.BoundingBox.Top,right:c.BoundingBox.Left+c.BoundingBox.Width,bottom:c.BoundingBox.Top+c.BoundingBox.Height,width:c.BoundingBox.Width,height:c.BoundingBox.Height,element:e("<div class='ilab-face-outline hidden'><span>"+(l+1)+"</span></div>")};n.push(g);var u=this;!function(n){g.element.on("click",function(i){o=n,u.displayFaces(),e(document).trigger("change-faceindex",[n]),t.preview()})}(l+1),t.editorArea.append(g.element),l++}if(n.length>1)i={left:s,top:a,right:d,bottom:h,width:d-s,height:h-a,element:e("<div class='ilab-all-faces-outline hidden'></div>")},t.editorArea.append(i.element);else i=null}this.updateFacePositions=function(){var e=t.editorArea.get(0).getBoundingClientRect(),o=t.previewImage.get(0).getBoundingClientRect(),s=o.top-e.top,a=o.left-e.left,d=(o.right,e.left,o.bottom,e.top,o.width),h=o.height;if(null!=i){var l=a+d*i.left,c=s+h*i.top,g=d*i.width,u=h*i.height;i.element.css({left:l+"px",top:c+"px",width:g+"px",height:u+"px"})}n.forEach(function(e){var t=a+d*e.left,n=s+h*e.top,i=d*e.width,o=h*e.height;e.element.css({left:t+"px",top:n+"px",width:i+"px",height:o+"px"})})},this.displayFaces=function(){this.updateFacePositions(),0==o?1==n.length?(n[0].element.removeClass("hidden"),n[0].element.addClass("active")):(null!=i&&i.element.removeClass("hidden"),n.forEach(function(e){e.element.addClass("hidden")})):(null!=i&&i.element.addClass("hidden"),n.forEach(function(e,t){e.element.removeClass("hidden"),e.element.removeClass("active"),t==o-1&&e.element.addClass("active")}))},this.hideFaces=function(){null!=i&&i.element.addClass("hidden"),n.forEach(function(e){e.element.addClass("hidden")})},this.disable=function(){e(document).trigger("change-usefaces",[!1]),this.hideFaces()},this.save=function(e){return e},e(document).on("usefaces-selected",function(i){if(0==n.length)return alert("No faces have been detected in this image.  To use this feature, you will need to have the Rekognition tool enabled if it isn't already."),void e(document).trigger("change-usefaces",[!1]);e(document).trigger("change-entropy",[!1]),e(document).trigger("change-edges",[!1]),t.focalPointEditor.disable(),this.displayFaces()}.bind(this)),e(document).on("usefaces-deselected",function(e){this.hideFaces()}.bind(this)),e(document).on("faceindex-changed",function(e,t){o=t,this.displayFaces()}.bind(this)),e(window).on("resize",function(){this.updateFacePositions()}.bind(this)),t.settings.settings.hasOwnProperty("focalpoint")&&"usefaces"==t.settings.settings.focalpoint&&(t.settings.settings.hasOwnProperty("faceindex")&&(o=t.settings.settings.faceindex),setTimeout(function(){this.updateFacePositions(),this.displayFaces()}.bind(this),300))};
var ILabFocalPointEditor=function(t,e){var i=t('<div class="ilabm-focal-point-icon"></div>'),o=.5,n=.5;e.settings.settings.hasOwnProperty("fp-x")&&(o=e.settings.settings["fp-x"]),e.settings.settings.hasOwnProperty("fp-y")&&(n=e.settings.settings["fp-y"]);var s=!1;this.updateFocalPointPosition=function(){var t=e.editorArea.get(0).getBoundingClientRect(),s=e.previewImage.get(0).getBoundingClientRect(),r=s.top-t.top,a=s.left-t.left,c=(s.right,t.left,s.bottom,t.top,s.width),p=s.height,d=a+c*o,f=r+p*n;d-=12,f-=12,i.css({left:d+"px",top:f+"px"})},this.buildFocalPoint=function(){i.remove(),e.editorArea.append(i),this.updateFocalPointPosition()},this.disable=function(){t(document).trigger("change-focalpoint",[!1]),s=!1,i.remove()},this.save=function(t){return t.hasOwnProperty("focalpoint")&&(t["fp-x"]=o,t["fp-y"]=n),t},t(document).on("focalpoint-selected",function(i){t(document).trigger("change-entropy",[!1]),t(document).trigger("change-edges",[!1]),e.faceEditor.disable(),s=!0,this.buildFocalPoint()}.bind(this)),t(document).on("focalpoint-deselected",function(t){s=!1,i.remove()}.bind(this)),e.editorArea.on("mousedown",function(t){if(t.preventDefault(),!s)return!1;this.buildFocalPoint();var r=e.editorArea.get(0).getBoundingClientRect(),a=e.previewImage.get(0).getBoundingClientRect(),c={top:a.top-r.top,left:a.left-r.left,right:a.right-r.left,bottom:a.bottom-r.top,width:a.width,height:a.height};return e.editorArea.on("mousemove",function(t){t.preventDefault();var e=t.clientX-r.left;e<c.left?e=c.left:e>c.right&&(e=c.right);var s=t.clientY-r.top;return s<c.top?s=c.top:s>c.bottom&&(s=c.bottom),o=(e-c.left)/c.width,n=(s-c.top)/c.height,e-=12,s-=12,i.css({left:e+"px",top:s+"px"}),!1}.bind(this)),e.editorArea.on("mouseup",function(t){return t.preventDefault(),e.editorArea.off("mouseup"),e.editorArea.off("mousemove"),e.preview(),!1}.bind(this)),!1}.bind(this)),t(window).on("resize",function(){this.updateFocalPointPosition()}.bind(this)),e.settings.settings.hasOwnProperty("focalpoint")&&"focalpoint"==e.settings.settings.focalpoint&&(s=!0,setTimeout(function(){this.buildFocalPoint()}.bind(this),300))};
var ILabImageEdit=function(e,i){var t=this;function a(){t.displayStatus("Building preview ..."),t.waitModal.removeClass("is-hidden"),t.postAjax("ilab_imgix_preview",{},function(e){if("ok"==e.status){var i=e.src==t.previewImage.attr("src"),a=!1;t.previewImage.on("load",function(){a=!0,t.waitModal.addClass("is-hidden"),t.hideStatus()}),t.previewImage.on("error",function(){a=!0,t.waitModal.addClass("is-hidden"),t.hideStatus()}),t.previewImage.attr("src",e.src),i&&setTimeout(function(){a||(t.waitModal.addClass("is-hidden"),t.hideStatus())},3e3)}else t.waitModal.addClass("is-hidden"),t.hideStatus()})}this.previewTimeout=null,this.previewsSuspended=!1,this.parameters=[],this.settings=i,this.modalContainer=e("#ilabm-container-"+i.modal_id),this.editorArea=this.modalContainer.find(".ilabm-editor-area"),this.waitModal=this.modalContainer.find(".ilabm-preview-wait-modal"),this.previewImage=this.modalContainer.find(".imgix-preview-image"),this.presets=new ILabImgixPresets(e,this,this.modalContainer),this.focalPointEditor=new ILabFocalPointEditor(e,this),this.faceEditor=new ILabFaceEditor(e,this),this.modalContainer.find(".imgix-button-reset-all").on("click",function(){t.resetAll()}),this.modalContainer.find(".imgix-button-save-adjustments").on("click",function(){t.apply()}),this.modalContainer.find(".imgix-parameter").each(function(){var i=e(this),a=i.data("param-type");"slider"==a?t.parameters.push(new ImgixComponents.ImgixSlider(t,i)):"color"==a||"blend-color"==a?t.parameters.push(new ImgixComponents.ImgixColor(t,i)):"pillbox"==a?t.parameters.push(new ImgixComponents.ImgixPillbox(t,i)):"media-chooser"==a?t.parameters.push(new ImgixComponents.ImgixMediaChooser(t,i)):"alignment"==a&&t.parameters.push(new ImgixComponents.ImgixAlignment(t,i))}),this.modalContainer.on("click",".imgix-pill",function(){var i=e(this).data("param"),a=t.modalContainer.find("#imgix-param-"+i);1==a.val()?(a.val(0),e(this).removeClass("pill-selected")):(a.val(1),e(this).addClass("pill-selected")),t.preview()}),this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:t.settings.size,tabSelected:function(e){ILabModal.loadURL(e.data("url"),!0,function(e){t.bindUI(e)})}}),this.modalContainer.find(".ilabm-sidebar-tabs").ilabSidebarTabs({delegate:this,container:this.modalContainer}),this.postAjax=function(i,a,s){var n={};t.parameters.forEach(function(e,i){n=e.saveValue(n)}),n=this.focalPointEditor.save(n),n=this.faceEditor.save(n),a.image_id=t.settings.image_id,a.action=i,a.size=t.settings.size,a.settings=n,e.post(ajaxurl,a,s)},this.preview=function(){t.previewsSuspended||(ILabModal.makeDirty(),clearTimeout(t.previewTimeout),t.previewTimeout=setTimeout(a,500))},this.bindUI=function(e){if(e.hasOwnProperty("currentPreset")&&null!=e.currentPreset&&""!=e.currentPreset){var i=t.settings.presets[e.currentPreset];t.presets.setCurrentPreset(e.currentPreset,i.default_for==e.size)}else t.presets.clearSelected();t.previewsSuspended=!0,t.settings.size=e.size,t.settings.settings=e.settings;var a=function(){t.previewImage.off("load",a),t.parameters.forEach(function(i,t){i.reset(e.settings)}),t.previewsSuspended=!1,ILabModal.makeClean(),t.buildFocalPoint()};e.src?(t.previewImage.on("load",a),t.previewImage.attr("src",e.src)):a()},this.bindPreset=function(e){t.previewsSuspended=!0,t.settings.settings=e.settings,t.previewImage.off("load"),t.parameters.forEach(function(e,i){e.reset(t.settings.settings)}),t.previewsSuspended=!1,t.preview()},this.apply=function(){t.displayStatus("Saving adjustments ..."),t.postAjax("ilab_imgix_save",{},function(e){t.hideStatus(),ILabModal.makeClean(),alert("Adjustments have been saved.")})},this.resetAll=function(){t.parameters.forEach(function(e,i){e.reset()})},this.displayStatus=function(e){t.modalContainer.find(".ilabm-status-label").text(e),t.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){t.modalContainer.find(".ilabm-status-container").addClass("is-hidden")},e(document).on("edges-selected",function(i){e(document).trigger("change-entropy",[!1]),this.faceEditor.disable(),this.focalPointEditor.disable()}.bind(this)),e(document).on("entropy-selected",function(i){e(document).trigger("change-edges",[!1]),this.faceEditor.disable(),this.focalPointEditor.disable()}.bind(this))};